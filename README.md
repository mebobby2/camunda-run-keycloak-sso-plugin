# run-engine-plugin

This project illustartes how to create a jar file which can be used as a plugin for the [CAMUNDA RUN](https://docs.camunda.org/manual/latest/installation/camunda-bpm-run/) distribution.


## How it works

If a regular jar is placed into the distribution's *configuration\userlib* folder then the classes will be available (e.g. a JavaDelegate implemenatation to be used in a service task).    

To add a plugin configuration dynamically or to register Spring beans, which can be used as Delegates, these Spring components need to be found by Spring during startup. The jar needs to become an executable jar, which can be added as a Spring Boot module.

- in the [pom.xml](/pom.xml) file the maven-jar-plugin is used to and the main class *springframework.boot.loader.PropertiesLauncher* to the MAINFEST.MF which will be generated by maven during the build.

In Camunda RUN the [Spring component scan](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/ComponentScan.html) is set to scan the package **org.camunda.bpm.run**. If Classes with Spring annotations within our jar reside in this base package (includeing its sub packages), then they will be found automatically.

If the custom code in our jar uses another package, as it usually would, then additional configuration is required to tell Spring that an additinal base package needs to be scanned.

- In the class name inside [/src/main/resources/spring.META-INF/spring.factories](/src/main/resources/spring.META-INF/spring.factories) points to a Spring Configuration class, which will be loaded during startup.
  
- The configuration class, here [org.company.camunda.MySpringConfig.java](src/main/java/org/company/camunda/MySpringConfig.java) defines the additional configuration, extending the Spring component scan to the desired custom base package names.

Since the component scan has been extended to *org.company.camunda.plugin* and *org.company.camunda.delegate*, the delegate implementataion and the process engine plugin will now be loaded by Spring during startup.


## Usage

- build the jar file using **maven clean package**
- copy the resulting jar file (e.g. run-engine-plugin-1.0-SNAPSHOT.jar) from the target folder into the Camunda RUN **configuration\userlib** folder and start the server.
- deploy [/model/process.bpmn](/model/process.bpmn) an start a process. The delegate should be found and the log output *!!! Executing MyJobRetryCmd for job...* from the engine plugin should be visible in the console.
